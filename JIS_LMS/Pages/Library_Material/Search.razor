@page "/Materials/Search"
@layout SystemAdminLayout
@using Microsoft.EntityFrameworkCore
@using JIS_LMS.Data;
@using JIS_LMS.Model
@using Microsoft.AspNetCore.Components.Forms
@inject Library_MaterialService Library_MaterialService
@inject LMSDbContext DbContext


@if (materials == null)
{
    <p style="color:red">loading....</p>
}

else
{
    <div class="form-group">

        <Select @onchange="MaterialChange">
            <option value="">Select Type</option>
            @foreach (var type in Enum.GetValues(typeof(LibraryMaterialType)))
            {


                <option value="@(type)"> @(type)</option>
            }
        </Select>
    </div>

    <div style="visibility:@Bookvisible;">
        <RadzenGrid AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterMode="FilterMode.Advanced" AllowPaging="true" PageSize="8"
                    AllowSorting="true" Data="@books" TItem="Book" Value="@book" ColumnWidth="200px" Style=" font-family:'Courier New';font-weight:bolder">
            <Columns>
                <RadzenGridColumn TItem="Book" Property="ISBN" Title="ISBN" />



            </Columns>
        </RadzenGrid>
    </div>

}

@code
{
    //library material code
    IEnumerable<Library_Material> materials;
    RadzenGrid<Library_Material> materialsGrid;
    Library_Material libraryMaterial;
    IQueryable<Library_Material> libraryMaterials;

    //Book code
    Book book;
    IQueryable<Book> books;

    //Journal code
    Journal journal;
    IQueryable<Journal> journals;

    // CD/DVD/BR code
    CD_DVD_BR cD_DVD_BR;
    IQueryable<CD_DVD_BR> cD_DVD_BRs;

    LMSDbContext db = new LMSDbContext();

    string libraryMaterialType { get; set; }

    string Bookvisible = "hidden";
    string Journalvisible = "hidden";
    string CD_DVD_BR_visible = "hidden";

    protected override void OnInitialized()
    {
        materials = DbContext.Library_Material.Include("Book").Include("Journal").Include("CD_DVD_BR").ToList();

        libraryMaterials = db.Library_Material.Include("Book").Include("Journal").Include("CD_DVD_BR");

        books = db.Book.Include("Library_Material");

        journals = db.Journal.Include("Library_Material");

        cD_DVD_BRs = db.CD_DVD_BR.Include("Library_Material");

        libraryMaterial = libraryMaterials.FirstOrDefault();
    }

    //Method to change library matrial type
    private void MaterialChange(ChangeEventArgs libraryMaterialEvent)
    {
        libraryMaterialType = (libraryMaterialEvent.Value.ToString());

        //Shows datagrid of only books
        if (libraryMaterialType == "Book")
        {
            Bookvisible = "visible";
            Journalvisible = "hidden";
            CD_DVD_BR_visible = "hidden";
        }

        //Shows datagrid of only journals
        else if (libraryMaterialType == "Journal")
        {
            Journalvisible = "visible";
            Bookvisible = "hidden";
            CD_DVD_BR_visible = "hidden";
        }

        //Shows datagrid of only CD/DVD/BR
        else if (libraryMaterialType == "CdDvdBr")
        {
            CD_DVD_BR_visible = "visible";
            Journalvisible = "hidden";
            Bookvisible = "hidden";

        }

    }
}
